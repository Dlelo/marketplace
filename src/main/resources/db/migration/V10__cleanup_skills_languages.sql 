-- ==========================================
-- Cleanup old skills/languages columns and tables
-- ==========================================

-- Drop old string columns (if they exist)
ALTER TABLE house_help DROP COLUMN IF EXISTS skills;
ALTER TABLE house_help DROP COLUMN IF EXISTS languages;

-- Drop old join tables (if they exist)
DROP TABLE IF EXISTS house_help_skills;
DROP TABLE IF EXISTS house_help_languages;

-- ==========================================
-- Create new join tables for enum collections
-- ==========================================

-- Skills
CREATE TABLE house_help_skills (
    house_help_id BIGINT NOT NULL,
    skills VARCHAR(50) NOT NULL,
    CONSTRAINT fk_house_help_skills
        FOREIGN KEY (house_help_id)
        REFERENCES house_help(id)
        ON DELETE CASCADE
);

-- Languages
CREATE TABLE house_help_languages (
    house_help_id BIGINT NOT NULL,
    languages VARCHAR(50) NOT NULL,
    CONSTRAINT fk_house_help_languages
        FOREIGN KEY (house_help_id)
        REFERENCES house_help(id)
        ON DELETE CASCADE
);

-- ==========================================
-- Seed default values for existing HouseHelp records
-- ==========================================

-- Skills defaults
INSERT INTO house_help_skills (house_help_id, skills)
SELECT id, 'CLEANING'
FROM house_help;

INSERT INTO house_help_skills (house_help_id, skills)
SELECT id, 'HOUSEKEEPING'
FROM house_help;

-- Languages defaults
INSERT INTO house_help_languages (house_help_id, languages)
SELECT id, 'ENGLISH'
FROM house_help;

INSERT INTO house_help_languages (house_help_id, languages)
SELECT id, 'SWAHILI'
FROM house_help;

-- ==========================================
-- Verification (optional)
-- ==========================================
-- SELECT DISTINCT skills FROM house_help_skills;
-- SELECT DISTINCT languages FROM house_help_languages;
